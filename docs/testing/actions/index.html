<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Testing Actions</title>
  <meta name="description" content="A library for managing data within JavaScript applications. Alt is a pure flux implementation that is small, terse, well tested, extremely flexible, and forward thinking.
">

  <link rel="canonical" href="https://goatslacker.github.io/alt/docs/testing/actions/">
  <link rel="alternate" type="application/rss+xml" title="Alt" href="https://goatslacker.github.io/alt/feed.xml" />

  <link type="text/css" rel="stylesheet" href="/alt/assets/lotus.min.css" />
  <link type="text/css" rel="stylesheet" href="/alt/assets/prism.min.css" />
  <link type="text/css" rel="stylesheet" href="/alt/assets/styles.css" />
</head>


  <body>

    
<header class="sp-horiz-lg">
  <div class="row">
    <div class="col c2">
      <a href="/alt/"><img class="logo" src="/alt/assets/alt.png" alt="Alt" width="40" /></a>
    </div>
    <div class="col c10">
      <nav class="txt-light txt-right pure-menu pure-menu-horizontal">
        <ul class="pure-menu-list">
          <li class="pure-menu-item">
            <a href="/alt/guide/" class="pure-menu-link">Getting Started</a>
          </li>
          <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
            <a href="/alt/docs/" id="menuLink1" class="pure-menu-link">API Documentation</a>
            <ul class="pure-menu-children">
              
              <li class="pure-menu-item">
                <a href="/alt/docs/createActions" class="pure-menu-link">Creating Actions</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/alt/docs/actions" class="pure-menu-link">Actions</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/alt/docs/createStore" class="pure-menu-link">Creating Stores</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/alt/docs/stores" class="pure-menu-link">Stores</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/alt/docs/lifecycleListeners" class="pure-menu-link">Lifecycle Listeners</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/alt/docs/bootstrap" class="pure-menu-link">Bootstrap</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/alt/docs/takeSnapshot" class="pure-menu-link">Take Snapshot</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/alt/docs/flush" class="pure-menu-link">Flush</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/alt/docs/recycle" class="pure-menu-link">Recycle</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/alt/docs/rollback" class="pure-menu-link">Rollback</a>
              </li>
              
              <li class="pure-menu-item">
                <a href="/alt/docs/altInstances" class="pure-menu-link">Alt Instances</a>
              </li>
              
            </ul>
          </li>
          <li class="pure-menu-item">
            <a href="/alt/blog/">Blog</a>
          </li>
          <li class="pure-menu-item">
            <a href="https://gitter.im/goatslacker/alt">Support</a>
          </li>
          <li class="pure-menu-item">
            <a href="https://github.com/goatslacker/alt">GitHub</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</header>


    <div class="main sp-vert-md sp-horiz-lg">
      <div class="row">
        <div class="col c2">
          <ul class="sidenav">
  
  <li>
    <a href="/alt/docs/createActions">Creating Actions</a>
  </li>
  
  <li>
    <a href="/alt/docs/actions">Actions</a>
  </li>
  
  <li>
    <a href="/alt/docs/createStore">Creating Stores</a>
  </li>
  
  <li>
    <a href="/alt/docs/stores">Stores</a>
  </li>
  
  <li>
    <a href="/alt/docs/lifecycleListeners">Lifecycle Listeners</a>
  </li>
  
  <li>
    <a href="/alt/docs/bootstrap">Bootstrap</a>
  </li>
  
  <li>
    <a href="/alt/docs/takeSnapshot">Take Snapshot</a>
  </li>
  
  <li>
    <a href="/alt/docs/flush">Flush</a>
  </li>
  
  <li>
    <a href="/alt/docs/recycle">Recycle</a>
  </li>
  
  <li>
    <a href="/alt/docs/rollback">Rollback</a>
  </li>
  
  <li>
    <a href="/alt/docs/altInstances">Alt Instances</a>
  </li>
  
</ul>

        </div>
        <div class="col c10">
          <div class="sp-horiz-md">
            <h1 id="testing-actions">Testing Actions</h1>

<h2 id="conceptual-how-to">Conceptual how to</h2>

<p>The good news about testing actions is that you probably won’t have to do a lot of testing! Most Flux actions just pass data directly to the dispatcher, which then gets passed to the store to be handled.</p>

<p>However, there are instances where actions will modify the data in some way before passing it on to the dispatcher. We can test these by “spying on”/listening to the dispatcher and ensuring that <code>alt.dispatcher.dispatch</code> is called with the correct payload.</p>

<p>An action might also have other side effects such as calling another action, in which case we might also need to “spy” on that action to ensure that it is also called correctly.</p>

<p>Let’s jump into it with an example:</p>

<h1 id="example">Example</h1>

<h2 id="action">Action</h2>
<pre><code class="language-javascript">import alt from 'MyAlt';
import legalActions from 'actions/LegalActions';

class PetActions {
  constructor() {
    // these we do not need to test as we trust alt tests `generateActions`
    this.generateActions('buyPet', 'sellPet');
  }

  // this action modifies the dispatched data AND calls another action
  buyExoticPet({pet, cost}) {
    var importCost = 1000,
        illegalAnimals = ['dragon', 'unicorn', 'cyclops'],
        // adds import charge to cost
        totalCost = importCost + cost;

    this.dispatch({
      pet,
      cost: totalCost
    });

    // checks if pet is legal
    if(illegalAnimals.indexOf(pet) &gt;= 0) {
      legalActions.illegalPet(pet);
    }
  }
}

export default alt.createActions(PetActions);
</code></pre>

<h2 id="action-test">Action Test</h2>

<pre><code class="language-javascript">import alt from 'MyAlt';
import petActions from 'actions/PetActions';
import legalActions from 'actions/LegalActions';
// you can use any assertion lib you want
import {assert} from 'chai';
// we will use [sinon](http://sinonjs.org/docs/) for spying, but you can use any similar lib
import sinon from 'sinon';

describe('PetActions', () =&gt; {
  beforeEach(() =&gt; {
    // here we use sinon to create a spy on the alt.dispatcher.dispatch function
    this.dispatcherSpy = sinon.spy(alt.dispatcher, 'dispatch');
    this.illegalSpy = sinon.spy(legalActions, 'illegalPet');
  });

  afterEach(() =&gt; {
    // clean up our sinon spy so we do not affect other tests
    alt.dispatcher.dispatch.restore();
    legalActions.illegalPet.restore();
  });

  describe('#buyExoticPet', () =&gt; {
    it('dispatches correct data', () =&gt; {
      var pet = 'moose',
          cost = 18.20,
          totalCost = 1000 + cost,
          action = petActions.BUY_EXOTIC_PET;

      // fire the action
      petActions.buyExoticPet({pet, cost});
      // use our spy to see what payload the dispatcher was called with
      // this lets us ensure that the expected payload (with US dollars) was fired
      assert(this.dispatcherSpy.calledWith({action, data: {pet, cost: totalCost}}), 'dispatcher did not receive correct payload');
    });

    it('does not fire illegal action for legal pets', () =&gt; {
      var pet = 'dog',
          cost = 18.20;

      // fire the action
      petActions.buyExoticPet({pet, cost});
      // use our spy to ensure that the illegal action was NOT called
      assert.equal(this.illegalSpy.callCount, 0);
    });

    it('fires illegal action for illegal pets', () =&gt; {
      var pet = 'unicorn',
          cost = 18.20;

      // fire the action
      petActions.buyExoticPet({pet, cost});
      // use our spy to ensure that the illegal action was called
      assert(this.illegalSpy.calledOnce, 'the illegal action was not fired');
    });
  });
});
</code></pre>

          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.js"></script>
<script type="text/javascript">
  // Alias for javascript so syntax highlighting works fine
  Prism.languages.js = Prism.languages.javascript;
</script>
<footer class="sp-vert-md">
  <a href="https://www.npmjs.com/package/alt"><img src="https://img.shields.io/npm/v/alt.png?style=flat-square" alt="npm version" /></a>
  <a href="https://gitter.im/goatslacker/alt"><img src="https://img.shields.io/badge/gitter-join%20chat-ff7d29.svg?style=flat-square" alt="Gitter Chat" /></a>
</footer>


  </body>

</html>
